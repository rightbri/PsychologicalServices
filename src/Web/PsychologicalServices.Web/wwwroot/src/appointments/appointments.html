<template>
	<require from="common/week-view"></require>
	<require from="valueConverters/boolean"></require>
	<require from="valueConverters/date-format"></require>
	<require from="valueConverters/appointment-for-day"></require>
	
<h2>Appointments</h2>

<week-view>
	<template replace-part="dayHeader">
		<div class="col-xs-12">
			<a route-href="route: editAssessment; params.bind: { id: 0, assessment: newAssessment(day) }" class="btn btn-default btn-xs pull-left">
				<i class="fa fa-plus"></i>
			</a>
			<p class="pull-left">
				${day | dateFormat:'dddd'}
			</p>
			<p class="pull-right">
				${day | dateFormat:'MMMM DD, YYYY'}
			</p>
		</div>
	</template>
	<template replace-part="dayNotes">
		<div class="row calendar-note" repeat.for="note of getNotes(day)" if.bind="hasNotes(day)">
			<div class="col-xs-offset-1 col-xs-11">
				<p class="summary">
					${note.note.noteText}
				</p>
			</div>
		</div>
	</template>
	<template replace-part="dayContent">
		<div class="row" repeat.for="appointment of appointments | appointmentForDay:day">
			<div class="col-xs-1">
				<a route-href="route: editAssessment; params.bind: { id: appointment.assessment.assessmentId }" class="btn btn-default btn-xs">
					<i class="fa fa-edit"></i>
				</a>
			</div>
			<div class="col-xs-1" title="Time">
				${appointment.appointmentTime | dateFormat:config.shortTimeFormat}
			</div>
			<div class="col-xs-1" title="Psychometrist">
				${appointment.psychometrist.firstName}
				<br>${appointment.psychometristConfirmed | boolean }
			</div>
			<div class="col-xs-2" title="Referral Source">
				${appointment.assessment.referralSource.name}
			</div>
			<div class="col-xs-2" title="Location" with.bind="appointment.location">
				<p class="address">
					${street}
					<br if.bind="suite"><span if.bind="suite">${suite}</span>
					<br>${city}, ${province} ${postalCode}
				</p>
			</div>
			<div class="col-xs-1" title="Assessment Type">
				${appointment.assessment.assessmentType.name}
			</div>
			<div class="col-xs-2">
				<p repeat.for="claim of appointment.assessment.claims" title="Claimant">
					${claim.claimant.firstName} ${claim.claimant.lastName}
					<br>Age: ${claim.claimant.age}
				</p>
				<p class="Report Status">
					${appointment.assessment.reportStatus.name}
				</p>
				<p if.bind="appointment.assessment.medicalFileReceivedDate">
					(${appointment.assessment.medicalFileReceivedDate | dateFormat:config.shortDateFormat})
				</p>
			</div>
			<div class="col-xs-1" title="Appointment Status">
				${appointment.appointmentStatus.name}
			</div>
		</div>
	</template>
</week-view>

<p click.delegate="toggleSearch()">Search</p>
<div class="container-fluid" show.bind="showSearch">
	<div class="row">
		<div class="col-xs-4">
			<form class="search-parameters">
				<div class="form-group">
					<label for="searchStartDate">Date Start</label>
					<input id="searchStartDate" class="form-control" type="text" placeholder="MM/DD/YYYY" value.bind="searchStart" />
				</div>
				<div class="form-group">
					<label for="searchEndDate">Date End</label>
					<input id="searchEndDate" class="form-control" type="text" placeholder="MM/DD/YYYY" value.bind="searchEnd" />
				</div>
				<div class="form-group">
					<label for="searchPsychometrist">Psychometrist</label>
					<select id="searchPsychometrist" class="form-control" value.bind="searchPsychometrist">
						<option model.bind="null"></option>
						<option repeat.for="psychometrist of psychometrists" model.bind="psychometrist.userId">
							${psychometrist.firstName} ${psychometrist.lastName}
						</option>
					</select>
				</div>
				<div class="form-group">
					<label for="searchPsychologist">Psychologist</label>
					<select id="searchPsychologist" class="form-control" value.bind="searchPsychologist">
						<option model.bind="null"></option>
						<option repeat.for="psychologist of psychologists" model.bind="psychologist.userId">
							${psychologist.firstName} ${psychologist.lastName}
						</option>
					</select>
				</div>
				<div class="form-group">
					<label for="searchStatus">Status</label>
					<select id="searchStatus" class="form-control" value.bind="searchStatus">
						<option model.bind="null"></option>
						<option repeat.for="appointmentStatus of appointmentStatuses" model.bind="appointmentStatus.appointmentStatusId">
							${appointmentStatus.name}
						</option>
					</select>
				</div>
				<div class="form-group">
					<label for="searchCompany">Company</label>
					<select id="searchCompany" class="form-control" value.bind="searchCompany">
						<option if.bind="hasMultipleCompanies(companies)" model.bind="null"></option>
						<option repeat.for="company of companies" model.bind="company.companyId">
							${company.name}
						</option>
					</select>
				</div>
				<button class="btn btn-default" type="button" click.delegate="search()">Search</button>
			</form>
		</div>
	</div>
</div>

</template>