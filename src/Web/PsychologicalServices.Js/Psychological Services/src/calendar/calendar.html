<template>
	<require from="resources/value-converters/boolean"></require>
	<require from="resources/value-converters/date-format"></require>
	<require from="assessments/view-assessment-summary"></require>
	<require from="resources/value-converters/note-for-day"></require>
	<require from="resources/value-converters/appointment-for-day"></require>
	<require from="resources/value-converters/attribute-types"></require>
	<require from="common/date-picker"></require>
	<require from="common/fixed-header"></require>
	<require from="../../content/css/fixed-header.css"></require>
	

<form class="uk-form-horizontal uk-padding-small">
	<div class="uk-form-controls">
		<input type="text" class="uk-input uk-form-width-medium" date-picker.bind="config.monthPickerOptions" monthchanged.delegate="monthChanged($event)" value.bind="searchDate | dateFormat:'MMMM, YYYY'" />
		
		<div class="uk-button-group">
			<button type="button" class="uk-button ${currentView === 'schedule' ? 'uk-button-primary' : 'uk-button-default'}" click.delegate="setView('schedule')">Schedule</button>
			<button type="button" class="uk-button ${currentView === 'schedule' ? 'uk-button-default' : 'uk-button-primary'}" click.delegate="setView('up to date')">Up to date</button>
		</div>
	</div>
</form>

<div class="uk-overflow-auto">
	<table class="uk-table uk-table-divider" if.bind="currentView === 'schedule'" fixed-header>
	<thead>
		<tr>
			<th></th>
			<th>Time</th>
			<th>Type</th>
			<th>Source</th>
			<th>Location</th>
			<th>Claimant</th>
			<th>Psychometrist</th>
			<th>Info</th>
		</tr>
	</thead>
	<tbody>
		<template repeat.for="day of days">
		<tr>
			<td>
				<a route-href="route: addAssessment; params.bind: {'year': day.getFullYear(), 'month': day.getMonth() + 1, 'day': day.getDate() }" class="uk-text-primary uk-text-nowrap date-display" title="Create new assessment" uk-tooltip="pos: right">
					${day | dateFormat:'ddd MMM D'}
				</a>
			</td>
			<td colspan="6"></td>
			<td>
				<p class="calendar-note" repeat.for="calendarNote of calendarNotes | noteForDay:day">
					<small>${calendarNote.note.noteText}</small>
				</p>
			</td>
		</tr>
		<tr class="appointment" repeat.for="appointment of appointments | appointmentForDay:day">
			<td class="uk-table-shrink">
				<div class="uk-inline">
					<i class="fa fa-ellipsis-h fa-2x"></i>
					<div uk-dropdown="mode: click">
						<ul class="uk-nav uk-dropdown-nav">
							<li>
								<a route-href="route: editAssessment; params.bind: { id: appointment.assessment.assessmentId }">
									Edit
								</a>
							</li>
							<li>
								<a href.one-time="summaryModalToggleValue(appointment)" uk-toggle if.bind="appointment.assessment.summary">
									Summary
								</a>
							</li>
						</ul>
					</div>
				</div>
				<view-assessment-summary model.bind="appointment" container-id.bind="summaryModalContainerId(appointment)"></view-assessment-summary>
			</td>
			<td>
				<ul class="uk-list">
					<li title="Appointment Time" class="smaller-siblings">${appointment.appointmentTime | dateFormat:config.shortTimeFormat}</li>
					<li title="Appointment Status">${appointment.appointmentStatus.name}</li>
				</ul>
			</td>
			<td>
				<ul class="uk-list">
					<li title="Assessment Type" class="smaller-siblings">${appointment.assessment.assessmentType.name}</li>
					<li repeat.for="attribute of appointment.assessment.attributes | attributeTypes:[2,6]">
						${attribute.name}
					</li>
				</ul>
			</td>
			<td>
				<ul class="uk-list">
					<li title="Referral Source" class="smaller-siblings">${appointment.assessment.referralSource.name}</li>
					<li title="Report Status">${appointment.assessment.reportStatus.name}</li>
					<li title="Medical File Received Date" if.bind="appointment.assessment.medicalFileReceivedDate">Received: ${appointment.assessment.medicalFileReceivedDate | dateFormat:config.shortDateFormat}</li>
					<li title="Medical File Number" if.bind="appointment.assessment.referralSourceFileNumber">File No: ${appointment.assessment.referralSourceFileNumber}</li>
				</ul>
			</td>
			<td with.bind="appointment.location">
				<ul class="uk-list">
					<li title="Location Name" class="smaller-siblings" if.bind="name">${name}</li>
					<li title="Street" if.bind="street">${street}</li>
					<li title="Suite" if.bind="suite">${suite}</li>
					<li title="City, Province, Postal Code" if.bind="street || suite">${city.name}, ${city.province} ${postalCode}</li>
				</ul>
			</td>
			<td>
				<ul class="uk-list" repeat.for="claim of appointment.assessment.claims">
					<li title="Claimant Name" class="smaller-siblings" if.bind="claim.claimant">${claim.claimant.firstName} ${claim.claimant.lastName}</li>
					<li title="Claimant Age, Gender" if.bind="claim.claimant">${claim.claimant.age} ${claim.claimant.gender}</li>
					<li title="Date of Loss">DOL: ${claim.dateOfLoss | dateFormat:config.shortDateFormat}</li>
					<li title="Claim Number">Claim No: ${claim.claimNumber}</li>
				</ul>
			</td>
			<td>
				<ul class="uk-list">
					<li title="Psychometrist" class="smaller-siblings">${appointment.psychometrist.firstName}</li>
					<li repeat.for="attribute of appointment.attributes | attributeTypes:[1]">
						${attribute.name}
					</li>
					<li repeat.for="attribute of appointment.assessment.attributes | attributeTypes:[5]">
						${attribute.name}
					</li>
				</ul>
			</td>
			<td>
				<ul class="uk-list smaller-children">
					<li repeat.for="attribute of appointment.attributes | attributeTypes:[3]">
						${attribute.name}
					</li>
					<li repeat.for="attribute of appointment.assessment.attributes | attributeTypes:[4]">
						${attribute.name}
					</li>
				</ul>
			</td>
		</tr>
		</template>
	</tbody>
</table>
</div>

<div class="uk-overflow-auto">
	<table class="uk-table uk-table-divider" if.bind="currentView === 'up to date'" fixed-header>
	<thead>
		<tr>
			<th></th>
			<th>Location</th>
			<th>Claimant</th>
			<th>Source</th>
			<th>Psychiatrist</th>
			<th>Psychometrist</th>
			<th>Doc List Writer</th>
			<th>Notes Writer</th>
			<th>Report Status</th>
			<th>File Size</th>
			<th>Reports</th>
			<th>Info</th>
		</tr>
	</thead>
	<tbody>
		<template repeat.for="day of days">
		<tr>
			<td>
				<a route-href="route: addAssessment; params.bind: {'year': day.getFullYear(), 'month': day.getMonth() + 1, 'day': day.getDate() }" class="uk-text-primary uk-text-nowrap date-display" title="Create new assessment" uk-tooltip="pos: right">
					${day | dateFormat:'ddd MMM D'}
				</a>
			</td>
			<td colspan="11"></td>
		</tr>
		<tr class="appointment" repeat.for="appointment of appointments | appointmentForDay:day">
			<td class="uk-table-shrink">
				<a route-href="route: editAssessment; params.bind: { id: appointment.assessment.assessmentId }" class="uk-button uk-button-default" title="Edit Assessment">
					<i class="fa fa-pencil"></i>
				</a>
			</td>
			<td>${appointment.location.name}</td>
			<td>
				<ul class="uk-list" repeat.for="claim of appointment.assessment.claims">
					<li if.bind="claim.claimant">${claim.claimant.firstName} ${claim.claimant.lastName}</li>
				</ul>
			</td>
			<td>${appointment.assessment.referralSource.name}</td>
			<td>
				<ul class="uk-list">
					<li repeat.for="attribute of appointment.assessment.attributes | attributeTypes:[6]">
						${attribute.name === 'Psychiatrist' | boolean}
					</li>
				</ul>
			</td>
			<td>${appointment.psychometrist.firstName}</td>
			<td>${appointment.assessment.docListWriter.firstName}</td>
			<td>${appointment.assessment.notesWriter.firstName}</td>
			<td>${appointment.assessment.reportStatus.name}</td>
			<td>${appointment.assessment.fileSize}<span if.bind="appointment.assessment.isLargeFile">(L)</span></td>
			<td>
				<ul class="uk-list smaller-children">
					<li repeat.for="report of appointment.assessment.reports">
						${report.reportType.name}
						<ul class="smaller-children">
							<li repeat.for="issueInDispute of report.issuesInDispute">
								${issueInDispute.name}
							</li>
						</ul>
					</li>
				</ul>
			</td>
			<td>
				<ul class="uk-list smaller-children">
					<li repeat.for="attribute of appointment.assessment.attributes | attributeTypes:[4,5]">
						${attribute.name}
					</li>
				</ul>
			</td>
		</tr>
		</template>
	</tbody>
</table>
</div>
</template>