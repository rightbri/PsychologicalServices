<template>
	<require from="resources/value-converters/boolean"></require>
	<require from="resources/value-converters/date-format"></require>
	<require from="assessments/view-assessment-summary"></require>
	<require from="resources/value-converters/note-for-day"></require>
	<require from="resources/value-converters/appointment-for-day"></require>
	<require from="resources/value-converters/attribute-types"></require>
	<require from="resources/value-converters/sort-array"></require>
	<require from="calendarNotes/edit-calendar-note"></require>
	<require from="common/date-picker"></require>
	<require from="common/fixed-header"></require>
	<require from="../../content/css/fixed-header.css"></require>
	<require from="flatpickr/flatpickr.css"></require>

<div class="uk-child-width-1-2@s uk-padding-small" uk-grid>
	<div>
		<div class="uk-form-controls">
			<!--
			<a href="#" uk-slidenav-previous click.delegate="addMonths(-1)" title="Previous month" uk-tooltip="pos: top"></a>
			-->
			<input type="text" class="uk-input uk-form-width-medium" date-picker="options.bind: config.monthPickerOptions; dates.bind: searchDate" datechanged.delegate="dateChanged($event)" value.bind="searchDate | dateFormat:'MMMM, YYYY'" />
			<!--
			<a href="#" uk-slidenav-next click.delegate="addMonths(1)" title="Next month" uk-tooltip="pos: top"></a>
			-->
		</div>
	</div>
	<div>
		<div class="uk-button-group uk-align-right">
			<button type="button" class="uk-button ${currentView === 'schedule' ? 'uk-button-primary' : 'uk-button-default'}" click.delegate="setView('schedule')">Schedule</button>
			<button type="button" class="uk-button ${currentView === 'schedule' ? 'uk-button-default' : 'uk-button-primary'}" click.delegate="setView('up to date')">Up to date</button>
		</div>
	</div>
</div>

<div class="uk-overflow-auto">
	<table class="uk-table uk-table-divider" if.bind="currentView === 'schedule'" fixed-header>
	<thead>
		<tr>
			<th>
				<a href="#" uk-totop uk-scroll style="display: none;"></a>
			</th>
			<th>Time</th>
			<th>Type</th>
			<th>Source</th>
			<th>Location</th>
			<th>Claimant</th>
			<th>Psychometrist</th>
			<th>Info</th>
		</tr>
	</thead>
	<tbody>
		<template repeat.for="day of days">
			<tr>
				<td class="uk-table-shrink">
					<a route-href="route: addAssessment; params.bind: {'year': day.getFullYear(), 'month': day.getMonth() + 1, 'day': day.getDate() }" class="uk-text-primary uk-text-nowrap date-display" title="Create new assessment" uk-tooltip="pos: right">
						${day | dateFormat:'ddd MMM D'}
					</a>
				</td>
				<td colspan="6"></td>
				<td>
					<p class="calendar-note" repeat.for="calendarNote of calendarNotes | noteForDay:day" click.delegate="editCalendarNote(calendarNote)" uk-toggle="target: #calendar-note-form">
						<small>${calendarNote.note.noteText}</small>
					</p>
				</td>
			</tr>
			<template repeat.for="appointment of appointments | appointmentForDay:day | sortArray:{ property: 'appointmentTime', direction: 'asc' }">
			<tr class="appointment">
				<td class="uk-table-shrink">
					<ul class="uk-list">
						<li>
							<a route-href="route: editAssessment; params.bind: { id: appointment.assessment.assessmentId }" class="uk-link-text" title="Edit assessment" uk-tooltip="pos: right">
								<i class="fa fa-pencil"></i>
							</a>
						</li>
						<li if.bind="appointment.assessment.summary">
							<a href.bind="appointment.summaryModalToggleValue" class="uk-link-text" uk-toggle title="View summary" uk-tooltip="pos: right">
								<i class="fa fa-info"></i>
							</a>
						</li>
					</ul>
				</td>
				<td>
					<ul class="uk-list">
						<li title="Appointment Time" class="smaller-siblings">${appointment.appointmentTime | dateFormat:config.shortTimeFormat}</li>
						<li title="Appointment Status">${appointment.appointmentStatus.name}</li>
					</ul>
				</td>
				<td>
					<ul class="uk-list">
						<li title="Assessment Type" class="smaller-siblings">${appointment.assessment.assessmentType.name}</li>
						<li title="Completion" if.bind="appointment.isCompletion">Completion</li>
						<li repeat.for="attribute of appointment.assessment.attributes | attributeTypes:[2,6] | sortArray:{ property: 'name', direction: 'asc' }">
							${attribute.name}
						</li>
					</ul>
				</td>
				<td>
					<ul class="uk-list">
						<li title="Referral Source" class="smaller-siblings">${appointment.assessment.referralSource.name}</li>
						<li title="Report Status">${appointment.assessment.reportStatus.name}</li>
						<li title="Medical File Received Date" if.bind="appointment.assessment.medicalFileReceivedDate">Received: ${appointment.assessment.medicalFileReceivedDate | dateFormat:config.shortDateFormat}</li>
						<li title="Medical File Number" if.bind="appointment.assessment.referralSourceFileNumber">File No: ${appointment.assessment.referralSourceFileNumber}</li>
					</ul>
				</td>
				<td with.bind="appointment.location">
					<ul class="uk-list">
						<li title="Location Name" class="smaller-siblings" if.bind="name">${name}</li>
						<li title="Street" if.bind="street">${street}</li>
						<li title="Suite" if.bind="suite">${suite}</li>
						<li title="City, Province, Postal Code" if.bind="street || suite">${city.name}, ${city.province} ${postalCode}</li>
					</ul>
				</td>
				<td>
					<ul class="uk-list" repeat.for="claim of appointment.assessment.claims">
						<li title="Claimant Name" class="smaller-siblings" if.bind="claim.claimant">${claim.claimant.firstName} ${claim.claimant.lastName}</li>
						<li title="Claimant Age, Gender" if.bind="claim.claimant">${claim.claimant.age} ${claim.claimant.gender}</li>
						<li title="Date of Loss">DOL: ${claim.dateOfLoss | dateFormat:config.shortDateFormat}</li>
						<li title="Claim Number">Claim No: ${claim.claimNumber}</li>
					</ul>
				</td>
				<td>
					<ul class="uk-list">
						<li title="Psychometrist" class="smaller-siblings">${appointment.psychometrist.firstName}</li>
						<li repeat.for="attribute of appointment.attributes | attributeTypes:[1] | sortArray:{ property: 'name', direction: 'asc' }">
							${attribute.name}
						</li>
						<li repeat.for="attribute of appointment.assessment.attributes | attributeTypes:[5] | sortArray:{ property: 'name', direction: 'asc' }">
							${attribute.name}
						</li>
					</ul>
				</td>
				<td>
					<ul class="uk-list smaller-children">
						<li repeat.for="attribute of appointment.attributes | attributeTypes:[3] | sortArray:{ property: 'name', direction: 'asc' }">
							${attribute.name}
						</li>
						<li repeat.for="attribute of appointment.assessment.attributes | attributeTypes:[4] | sortArray:{ property: 'name', direction: 'asc' }">
							${attribute.name}
						</li>
					</ul>
				</td>
			</tr>
			<tr class="appointment-notes uk-text-small" if.bind="appointment.assessment.assessmentNotes.length">
				<td></td>
				<td colspan="7">
					<ul class="uk-list">
						<li repeat.for="note of appointment.assessment.assessmentNotes">
							${note.note.noteText}
						</li>
					</ul>
				</td>
			</tr>
			</template>
		</template>
	</tbody>
</table>
</div>

<div class="uk-overflow-auto">
	<table class="uk-table uk-table-divider" if.bind="currentView === 'up to date'" fixed-header>
	<thead>
		<tr>
			<th>
				<a href="#" uk-totop uk-scroll style="display: none;"></a>
			</th>
			<th>Location / Type / Claimant / Source</th>
			<th title="Psychiatrist">Psych?</th>
			<th>Psychometrist</th>
			<th>Doc List</th>
			<th>Notes</th>
			<th>Report Status</th>
			<th>File Size</th>
			<th>Reports</th>
			<th>Info</th>
		</tr>
	</thead>
	<tbody>
		<template repeat.for="day of days">
		<tr>
			<td class="uk-table-shrink">
				<a route-href="route: addAssessment; params.bind: {'year': day.getFullYear(), 'month': day.getMonth() + 1, 'day': day.getDate() }" class="uk-text-primary uk-text-nowrap date-display" title="Create new assessment" uk-tooltip="pos: right">
					${day | dateFormat:'ddd MMM D'}
				</a>
			</td>
			<td colspan="9"></td>
		</tr>
		<tr class="appointment" repeat.for="appointment of appointments | appointmentForDay:day">
			<td class="uk-table-shrink">
				<ul class="uk-list">
					<li>
						<a route-href="route: editAssessment; params.bind: { id: appointment.assessment.assessmentId }" class="uk-link-text" title="Edit assessment" uk-tooltip="pos: right">
							<i class="fa fa-pencil"></i>
						</a>
					</li>
					<li if.bind="appointment.assessment.summary">
						<a href.bind="appointment.summaryModalToggleValue" class="uk-link-text" uk-toggle title="View summary" uk-tooltip="pos: right">
							<i class="fa fa-info"></i>
						</a>
					</li>
				</ul>
			</td>
			<td class="uk-table-shrink">
				${appointment.location.name}
				<br>${appointment.assessment.assessmentType.name}
				<template if.bind="appointment.isCompletion">
				<br>Completion
				</template>
				<template repeat.for="claim of appointment.assessment.claims">
					<template if.bind="claim.claimant">
					<br>${claim.claimant.firstName} ${claim.claimant.lastName}
					</template>
				</template>
				<br>${appointment.assessment.referralSource.name}
			</td>
			<td>
				<ul class="uk-list">
					<li repeat.for="attribute of appointment.assessment.attributes | attributeTypes:[6] | sortArray:{ property: 'name', direction: 'asc' }">
						${attribute.name === 'Psychiatrist' | boolean}
					</li>
				</ul>
			</td>
			<td>${appointment.psychometrist.firstName}</td>
			<td>${appointment.assessment.docListWriter.firstName}</td>
			<td>${appointment.assessment.notesWriter.firstName}</td>
			<td>${appointment.assessment.reportStatus.name}</td>
			<td>${appointment.assessment.fileSize}<span if.bind="appointment.assessment.isLargeFile">(L)</span></td>
			<td>
				<ul class="uk-list smaller-children">
					<li repeat.for="report of appointment.assessment.reports">
						${report.reportType.name}
						<ul class="smaller-children">
							<li repeat.for="issueInDispute of report.issuesInDispute">
								${issueInDispute.name}
							</li>
						</ul>
					</li>
				</ul>
			</td>
			<td>
				<ul class="uk-list smaller-children">
					<li repeat.for="attribute of appointment.assessment.attributes | attributeTypes:[4,5,9] | sortArray:{ property: 'name', direction: 'asc' }">
						${attribute.name}
					</li>
				</ul>
			</td>
		</tr>
		</template>
	</tbody>
</table>
</div>
<view-assessment-summary model.bind="appointment" container-id.bind="appointment.summaryModalContainerId" repeat.for="appointment of appointments"></view-assessment-summary>
<edit-calendar-note model.bind="calendarNoteEditModel" addedCalendarNote.delegate="addedCalendarNote($event)" hide.delegate="hidCalendarNote($event)" if.bind="calendarNoteEditModel"></edit-calendar-note>
</template>