<template>
	<require from="resources/value-converters/boolean"></require>
	<require from="resources/value-converters/date-format"></require>
	<require from="resources/value-converters/time-ago"></require>
	<require from="resources/value-converters/gender"></require>
	<require from="resources/value-converters/attribute-types"></require>
	<require from="resources/value-converters/note-for-user"></require>
	<require from="resources/value-converters/filter"></require>
	<require from="resources/value-converters/sort-array"></require>
	<require from="common/validation-summary.html"></require>
	<require from="common/date-picker"></require>
	<require from="claimants/search-claimant"></require>
	<require from="notes/edit-note"></require>
	
<div class="uk-container">
	
	<fieldset class="uk-fieldset">
		<legend class="uk-legend">${editType} Assessment</legend>
		
		<form class="uk-form-stacked uk-grid-medium" uk-grid>
		
			<div class="uk-width-1-1" if.bind="validationErrors">
				<validation-summary errors.bind="validationErrors"></validation-summary>
			</div>
		
			<div class="uk-width-1-1">
				<label class="uk-form-label">Appointments</label>
				<div class="uk-form-controls uk-overflow-auto">
					<table class="uk-table uk-table-divider uk-table-small">
						<thead>
							<tr>
								<th>
									<a href="#" click.delegate="newAppointment()">
										<i class="fa fa-plus"></i>
									</a>
								</th>
								<th>Date/Time</th>
								<th>Location</th>
								<th>Status</th>
								<th>Psychometrist</th>
								<th>Info</th>
								<th></th>
							</tr>
						</thead>
						<tbody>
							<tr repeat.for="appointment of assessment.appointments | sortArray:{ property: 'appointmentTime', direction: 'desc' }">
								<td>
									<button type="button" class="uk-button uk-button-default" click.delegate="editAppointment(appointment)">
										Edit
									</button>
								</td>
								<td>
									${appointment.appointmentTime | dateFormat:config.longDateFormat}
									<br>${appointment.appointmentTime | dateFormat:config.shortTimeFormat}
								</td>
								<td>${appointment.location.name}</td>
								<td>${appointment.appointmentStatus.name}</td>
								<td>${appointment.psychometrist.firstName}</td>
								<td>
									<ul class="uk-list">
										<li repeat.for="attribute of appointment.attributes | attributeTypes:[1,3]">
											${attribute.name}
										</li>
									</ul>
								</td>
								<td>
									<a href="#" click.delegate="removeAppointment(appointment)">
										<i class="fa fa-times"></i>
									</a>
								</td>
							</tr>
						</tbody>
					</table>
				</div>
			</div>
			
			<div class="uk-width-1-3@s">
				<label for="type" class="uk-form-label" for="assessmentType">Assessment Type</label>
				<div class="uk-form-controls">
					<select id="assessmentType" class="uk-select" value.bind="assessment.assessmentType" matcher.bind="assessmentTypeMatcher">
						<option></option>
						<option repeat.for="assessmentType of assessmentTypes" model.bind="assessmentType">
							${assessmentType.name}
						</option>
					</select>
				</div>
			</div>
			
			<div class="uk-width-1-3@s">
				<label for="type" class="uk-form-label" for="referralSource">Referral Source</label>
				<div class="uk-form-controls">
					<select id="referralSource" class="uk-select" value.bind="assessment.referralSource" matcher.bind="referralSourceMatcher">
						<option></option>
						<option repeat.for="referralSource of referralSources" model.bind="referralSource">
							${referralSource.name}
						</option>
					</select>
				</div>
			</div>
			
			<div class="uk-width-1-3@s">
				<label for="type" class="uk-form-label" for="referralSourceContactEmail">Referral Source Contact Email</label>
				<div class="uk-form-controls">
					<input id="referralSourceContactEmail" type="email" class="uk-input" value.bind="assessment.referralSourceContactEmail" />
				</div>
			</div>
			
			<div class="uk-width-1-3@s">
				<label for="type" class="uk-form-label" for="referralType">Referral Type</label>
				<div class="uk-form-controls">
					<select id="referralType" class="uk-select" value.bind="assessment.referralType" matcher.bind="referralTypeMatcher">
						<option></option>
						<option repeat.for="referralType of referralTypes" model.bind="referralType">
							${referralType.name}
						</option>
					</select>
				</div>
			</div>
			
			<div class="uk-width-1-3@s">
				<label for="type" class="uk-form-label" for="medicalFileReceivedDate">Medical File Received Date</label>
				<div class="uk-form-controls">
					<input id="medicalFileReceivedDate" type="text" class="uk-input" date-picker.bind="config.datepickerOptions" value.bind="assessment.medicalFileReceivedDate | dateFormat:config.longDateFormat"/>
				</div>
			</div>
			
			<div class="uk-width-1-3@s">
				<label for="type" class="uk-form-label" for="fileNumber">File Number</label>
				<div class="uk-form-controls">
					<input id="fileNumber" type="text" class="uk-input" value.bind="assessment.referralSourceFileNumber" />
				</div>
			</div>
			
			<div class="uk-width-1-3@s">
				<label for="type" class="uk-form-label"></label>
				<div class="uk-form-controls">
					<label class="uk-form-label" repeat.for="attribute of attributes | attributeTypes:getAttributeTypeIds(assessment.assessmentType.attributeTypes)">
						<input type="checkbox" class="uk-checkbox" model.bind="attribute" checked.bind="assessment.attributes" matcher.bind="attributeMatcher" />&nbsp;${attribute.name}
					</label>
				</div>
			</div>
			
			<div class="uk-width-2-3@s">
				<label for="type" class="uk-form-label">Med Rehabs</label>
				<div class="uk-form-controls uk-overflow-auto">
					<table class="uk-table uk-table-divider uk-table-small">
						<thead>
							<tr>
								<th>
									<a href="#" click.delegate="newMedRehab()">
										<i class="fa fa-plus"></i>
									</a>
								</th>
								<th>Date</th>
								<th>Amount</th>
								<th>Description</th>
								<th></th>
							</tr>
						</thead>
						<tbody>
							<tr repeat.for="medRehab of assessment.medRehabs">
								<td>
									<button type="button" class="uk-button uk-button-default" click.delegate="editMedRehab(medRehab)">
										Edit
									</button>
								</td>
								<td>${medRehab.date | dateFormat:config.shortDateFormat}</td>
								<td>${medRehab.amount}</td>
								<td>${medRehab.description}</td>
								<td>
									<a href="#" click.delegate="removeMedRehab(medRehab)">
										<i class="fa fa-times"></i>
									</a>
								</td>
							</tr>
						</tbody>
					</table>
				</div>
			</div>
			
			<div class="uk-width-1-3@s">
				<label for="type" class="uk-form-label">Claimant</label>
				<div class="uk-form-controls">
					<search-claimant claimant.bind="claimant" selected.delegate="claimantSelected($event)"></search-claimant>
					<p if.bind="claimant">
						${claimant.firstName} ${claimant.lastName}
						<br>${claimant.age} - ${claimant.gender | gender}
					</p>
				</div>
			</div>
			
			<div class="uk-width-2-3@s">
				<label for="type" class="uk-form-label">Claims</label>
				<div class="uk-form-controls uk-overflow-auto">
					<table class="uk-table uk-table-divider uk-table-small">
						<thead>
							<tr>
								<th>
									<a href="#" click.delegate="newClaim()" disabled.bind="!claimant">
										<i class="fa fa-plus"></i>
									</a>
								</th>
								<th>Claim #</th>
								<th>Date of Loss</th>
								<th></th>
							</tr>
						</thead>
						<tbody>
							<tr repeat.for="claim of assessment.claims">
								<td>
									<button type="button" class="uk-button uk-button-default" click.delegate="editClaim(claim)">
										Edit
									</button>
								</td>
								<td>${claim.claimNumber}</td>
								<td>${claim.dateOfLoss | dateFormat:config.longDateFormat}</td>
								<td>
									<a href="#" click.delegate="removeClaim(claim)">
										<i class="fa fa-times"></i>
									</a>
								</td>
							</tr>
						</tbody>
					</table>
				</div>
			</div>
			
			<div class="uk-width-1-3@s">
			
				<div class="uk-margin">
					<label for="type" class="uk-form-label" for="docListWriter">Doc List Writer</label>
					<div class="uk-form-controls">
						<select id="docListWriter" class="uk-select" value.bind="assessment.docListWriter" matcher.bind="userMatcher">
							<option></option>
							<option repeat.for="user of docListWriters" model.bind="user">
								${user.firstName}
							</option>
						</select>
					</div>
				</div>
				
				<div class="uk-margin">
					<label for="type" class="uk-form-label" for="notesWriter">Notes Writer</label>
					<div class="uk-form-controls">
						<select id="notesWriter" class="uk-select" value.bind="assessment.notesWriter" matcher.bind="userMatcher">
							<option></option>
							<option repeat.for="user of notesWriters" model.bind="user">
								${user.firstName}
							</option>
						</select>
					</div>
				</div>
				
			</div>
			
			<div class="uk-width-2-3@s">
				<label for="type" class="uk-form-label">Reports</label>
				<div class="uk-form-controls uk-overflow-auto">
					<table class="uk-table uk-table-divider uk-table-small">
						<thead>
							<tr>
								<th>
									<a href="#" click.delegate="newReport()" disabled.bind="!assessment.assessmentType">
										<i class="fa fa-plus"></i>
									</a>
								</th>
								<th>Report Type</th>
								<th>Issues In Dispute</th>
								<th>Extra Benefit Report</th>
								<th></th>
							</tr>
						</thead>
						<tbody>
							<tr repeat.for="report of assessment.reports">
								<td>
									<button type="button" class="uk-button uk-button-default" click.delegate="editReport(report)">
										Edit
									</button>
								</td>
								<td>${report.reportType.name}</td>
								<td>
									<ul class="uk-list smaller-children">
										<li repeat.for="issueInDispute of report.issuesInDispute">
											${issueInDispute.name}
										</li>
									</ul>
								</td>
								<td>${report.isAdditional | boolean}</td>
								<td>
									<a href="#" click.delegate="removeReport(report)">
										<i class="fa fa-times"></i>
									</a>
								</td>
							</tr>
						</tbody>
					</table>
				</div>
			</div>
			
			<div class="uk-width-1-3@s">
				<label for="type" class="uk-form-label" for="reportStatus">Report Status</label>
				<div class="uk-form-controls">
					<select id="reportStatus" class="uk-select" value.bind="assessment.reportStatus" matcher.bind="reportStatusMatcher">
						<option></option>
						<option repeat.for="reportStatus of reportStatuses" model.bind="reportStatus">
							${reportStatus.name}
						</option>
					</select>
				</div>
			</div>
			
			<div class="uk-width-1-3@s">
				<label for="type" class="uk-form-label" for="fileSize">File Size</label>
				<div class="uk-form-controls">
					<input id="fileSize" type="number" class="uk-input" value.bind="assessment.fileSize" />
				</div>
			</div>
			
			<div class="uk-width-1-3@s">
				<label for="type" class="uk-form-label"></label>
				<div class="uk-form-controls">
					<label class="uk-form-label">
						<input type="checkbox" class="uk-checkbox" checked.bind="assessment.isLargeFile" />&nbsp;Large?
					</label>
				</div>
			</div>
			
			<div class="uk-width-1-1">
				<label for="type" class="uk-form-label">Notes</label>
				<div class="uk-form-controls uk-overflow-auto">
					<table class="uk-table uk-table-divider uk-table-small">
						<thead>
							<tr>
								<th>
									<button type="button" class="uk-button uk-button-link" click.delegate="newNote()">
										<i class="fa fa-plus"></i>
									</button>
								</th>
								<th>Note</th>
								<th>Update Date</th>
								<th>Updated By</th>
								<th></th>
							</tr>
						</thead>
						<tbody>
							<tr repeat.for="note of assessment.notes"><!--  | noteForUser:user-->
								<td>
									<button type="button" class="uk-button uk-button-default" click.delegate="editNote(note)">
										Edit
									</button>
								</td>
								<td>${note.noteText}</td>
								<td>${note.updateDate | timeAgo}</td>
								<td>${note.updateUser.firstName} ${note.updateUser.lastName}</td>
								<td>
									<button type="button" class="uk-button uk-button-link" click.delegate="removeNote(note)">
										<i class="fa fa-times"></i>
									</button>
								</td>
							</tr>
						</tbody>
					</table>
				</div>
			</div>
			
			<div class="uk-width-1-1" if.bind="noteToEdit">
				<edit-note note.bind="noteToEdit" edited.delegate="noteEdited" canceled.delegate="noteCanceled"></edit-note>
			</div>
			
			<div class="uk-width-3-4@s">
				<label for="type" class="uk-form-label" for="summary">Summary</label>
				<div class="uk-form-controls">
					<textarea id="summary" class="uk-textarea" value.bind="assessment.summary.noteText"></textarea>
				</div>
			</div>
			
			<div class="uk-width-1-4@s">
				<label for="type" class="uk-form-label">Colors</label>
				<div class="uk-form-controls">
					<label class="uk-form-label" repeat.for="color of colors">
						<input type="checkbox" class="uk-checkbox" model.bind="color" checked.bind="assessment.colors" matcher.bind="colorMatcher" />&nbsp;<span class="color-swatch" css="background-color: ${color.hexCode};"></span>
					</label>
				</div>
			</div>
			
			<div class="uk-width-1-2@s">
				<button type="button" class="uk-button uk-button-secondary" click.delegate="back()">
					<i class="fa fa-arrow-left"></i> Back
				</button>
				<button type="button" class="uk-button uk-button-primary" click.delegate="save()">
					Save <i class="fa fa-save"></i>
				</button>
			</div>
			
			<div class="uk-width-1-2@s" if.bind="assessment.updateUser">
				<p class="uk-text-meta">Created by ${assessment.createUser.firstName} ${assessment.createUser.lastName} at ${assessment.createDate | dateFormat:config.longDateTimeFormat}</p>
				<p class="uk-text-meta">Updated by ${assessment.updateUser.firstName} ${assessment.updateUser.lastName} at ${assessment.updateDate | dateFormat:config.longDateTimeFormat}</p>
			</div>
		</form>
		
	</fieldset>

</div>

</template>