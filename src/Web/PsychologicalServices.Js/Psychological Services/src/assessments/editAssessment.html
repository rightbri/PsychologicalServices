<template>
	<require from="resources/value-converters/boolean"></require>
	<require from="resources/value-converters/date-format"></require>
	<require from="resources/value-converters/time-ago"></require>
	<require from="resources/value-converters/gender"></require>
	<require from="resources/value-converters/attribute-types"></require>
	<require from="resources/value-converters/note-for-user"></require>
	<require from="resources/value-converters/filter"></require>
	<require from="resources/value-converters/sort-array"></require>
	<require from="common/validation-summary.html"></require>
	<require from="common/date-picker"></require>
	
<h2>${editType} Assessment</h2>

<div class="container-fluid">
	
	<div class="row" if.bind="validationErrors">
		<div class="col-xs-12">
			<validation-summary errors.bind="validationErrors"></validation-summary>
		</div>
	</div>
	
	<div class="row">
		<div class="col-xs-12">
			<table class="table table-striped table-condensed">
				<caption>Appointments</caption>
				<thead>
					<tr>
						<th>
							<button type="button" class="btn btn-default btn-xs" click.delegate="newAppointment()">
								<i class="fa fa-plus"></i>
							</button>
						</th>
						<th>Date/Time</th>
						<th>Location</th>
						<th>Status</th>
						<th>Psychometrist</th>
						<th>Info</th>
						<th></th>
					</tr>
				</thead>
				<tbody>
					<tr repeat.for="appointment of assessment.appointments | sortArray:{ property: 'appointmentTime', direction: 'desc' }">
						<td>
							<button type="button" class="btn btn-default btn-xs" click.delegate="editAppointment(appointment)">
								<i class="fa fa-edit"></i>
							</button>
						</td>
						<td>
							${appointment.appointmentTime | dateFormat:config.longDateFormat}
							<br>${appointment.appointmentTime | dateFormat:config.shortTimeFormat}
						</td>
						<td>${appointment.location.name}</td>
						<td>${appointment.appointmentStatus.name}</td>
						<td>${appointment.psychometrist.firstName}</td>
						<td>
							<ul class="list-unstyled">
								<li repeat.for="attribute of appointment.attributes | attributeTypes:[1,3]">
									${attribute.name}
								</li>
							</ul>
							
							
						</td>
						<td>
							<button type="button" class="btn btn-danger btn-xs" click.delegate="removeAppointment(appointment)">
								<i class="fa fa-times"></i>
							</button>
						</td>
					</tr>
				</tbody>
			</table>
		</div>
	</div>
	
	<div class="row">
		<div class="col-xs-3">
			<div class="form-group">
				<label for="assessmentType">Assessment Type</label>
				<select id="assessmentType" class="form-control" value.bind="assessment.assessmentType" matcher.bind="assessmentTypeMatcher">
					<option></option>
					<option repeat.for="assessmentType of assessmentTypes" model.bind="assessmentType">
						${assessmentType.name}
					</option>
				</select>
			</div>
		</div>
		<div class="col-xs-3">
			<div class="form-group">
				<label for="referralSource">Referral Source</label>
				<select id="referralSource" class="form-control" value.bind="assessment.referralSource" matcher.bind="referralSourceMatcher">
					<option></option>
					<option repeat.for="referralSource of referralSources" model.bind="referralSource">
						${referralSource.name}
					</option>
				</select>
			</div>
		</div>
		<div class="col-xs-3">
			<div class="form-group">
				<label for="referralSourceContactEmail">Referral Source Contact Email</label>
				<input id="referralSourceContactEmail" type="email" class="form-control" value.bind="assessment.referralSourceContactEmail" />
			</div>
		</div>
	</div>
	
	<div class="row">
		<div class="col-xs-3">
			<div class="form-group">
				<label for="referralType">Referral Type</label>
				<select id="referralType" class="form-control" value.bind="assessment.referralType" matcher.bind="referralTypeMatcher">
					<option></option>
					<option repeat.for="referralType of referralTypes" model.bind="referralType">
						${referralType.name}
					</option>
				</select>
			</div>
		</div>
		<div class="col-xs-3">
			<div class="form-group">
				<label for="medicalFileReceivedDate">Medical File Received Date</label>
				<input id="medicalFileReceivedDate" type="text" class="form-control" date-picker.bind="config.datepickerOptions" value.bind="assessment.medicalFileReceivedDate | dateFormat:config.longDateFormat"/>
			</div>
		</div>
		<div class="col-xs-3">
			<div class="form-group">
				<label for="fileNumber">File Number</label>
				<input id="fileNumber" type="text" class="form-control" value.bind="assessment.referralSourceFileNumber" />
			</div>
		</div>
	</div>
	
	<div class="row">
		<div class="col-xs-3">
			<div class="checkbox" repeat.for="attribute of attributes | attributeTypes:getAttributeTypeIds(assessment.assessmentType.attributeTypes)">
				<label>
					<input type="checkbox" model.bind="attribute" checked.bind="assessment.attributes" matcher.bind="attributeMatcher" />&nbsp;${attribute.name}
				</label>
			</div>
		</div>
	</div>
	
	<div class="row" if.bind="medRehabSelected">
		<div class="col-xs-12">
			<table class="table table-striped table-condensed">
				<caption>Med Rehabs</caption>
				<thead>
					<tr>
						<th>
							<button type="button" class="btn btn-default btn-xs" click.delegate="newMedRehab()">
								<i class="fa fa-plus"></i>
							</button>
						</th>
						<th>Date</th>
						<th>Amount</th>
						<th>Description</th>
						<th></th>
					</tr>
				</thead>
				<tbody>
					<tr repeat.for="medRehab of assessment.medRehabs">
						<td>
							<button type="button" class="btn btn-default btn-xs" click.delegate="editMedRehab(medRehab)">
								<i class="fa fa-edit"></i>
							</button>
						</td>
						<td>${medRehab.date | dateFormat:config.shortDateFormat}</td>
						<td>${medRehab.amount}</td>
						<td>${medRehab.description}</td>
						<td>
							<button type="button" class="btn btn-danger btn-xs" click.delegate="removeMedRehab(medRehab)">
								<i class="fa fa-times"></i>
							</button>
						</td>
					</tr>
				</tbody>
			</table>
		</div>
	</div>
	
	<div class="row">
		<div class="col-xs-6">
			<div class="form-group">
				<label>Claimant</label>
				<p class="form-control-static" if.bind="claimant">
					${claimant.firstName} ${claimant.lastName}
					<br>${claimant.age} - ${claimant.gender | gender}
				</p>
				<button type="button" class="btn btn-default btn-xs" click.delegate="searchClaimant()">
					Search <i class="fa fa-search"></i>
				</button>
			</div>
		</div>
		<div class="col-xs-6">
			<table class="table table-striped table-condensed">
				<caption>Claims</caption>
				<thead>
					<tr>
						<th>
							<button type="button" class="btn btn-default btn-xs" click.delegate="newClaim()" disabled.bind="!claimant">
								<i class="fa fa-plus"></i>
							</button>
						</th>
						<th>Claim #</th>
						<th>Date of Loss</th>
						<th></th>
					</tr>
				</thead>
				<tbody>
					<tr repeat.for="claim of assessment.claims">
						<td>
							<button type="button" class="btn btn-default btn-xs" click.delegate="editClaim(claim)">
								<i class="fa fa-edit"></i>
							</button>
						</td>
						<td>${claim.claimNumber}</td>
						<td>${claim.dateOfLoss | dateFormat:config.longDateFormat}</td>
						<td>
							<button type="button" class="btn btn-danger btn-xs" click.delegate="removeClaim(claim)">
								<i class="fa fa-times"></i>
							</button>
						</td>
					</tr>
				</tbody>
			</table>
		</div>
	</div>
	
	<div class="row">
		<div class="col-xs-6">
			<table class="table table-striped table-condensed">
				<caption>Reports</caption>
				<thead>
					<tr>
						<th>
							<button type="button" class="btn btn-default btn-xs" click.delegate="newReport()" disabled.bind="!assessment.assessmentType">
								<i class="fa fa-plus"></i>
							</button>
						</th>
						<th>Report Type</th>
						<th>Issues In Dispute</th>
						<th>Extra Benefit Report</th>
						<th></th>
					</tr>
				</thead>
				<tbody>
					<tr repeat.for="report of assessment.reports">
						<td>
							<button type="button" class="btn btn-default btn-xs" click.delegate="editReport(report)">
								<i class="fa fa-edit"></i>
							</button>
						</td>
						<td>${report.reportType.name}</td>
						<td>
							<ul class="list-unstyled smaller-children">
								<li repeat.for="issueInDispute of report.issuesInDispute">
									${issueInDispute.name}
								</li>
							</ul>
						</td>
						<td>${report.isAdditional | boolean}</td>
						<td>
							<button type="button" class="btn btn-danger btn-xs" click.delegate="removeReport(report)">
								<i class="fa fa-times"></i>
							</button>
						</td>
					</tr>
				</tbody>
			</table>
		</div>
		<div class="col-xs-3">
			<div class="form-group">
				<label for="docListWriter">Doc List Writer</label>
				<select id="docListWriter" class="form-control" value.bind="assessment.docListWriter" matcher.bind="userMatcher">
					<option></option>
					<option repeat.for="user of docListWriters" model.bind="user">
						${user.firstName}
					</option>
				</select>
			</div>
		</div>
		<div class="col-xs-3">
			<div class="form-group">
				<label for="notesWriter">Notes Writer</label>
				<select id="notesWriter" class="form-control" value.bind="assessment.notesWriter" matcher.bind="userMatcher">
					<option></option>
					<option repeat.for="user of notesWriters" model.bind="user">
						${user.firstName}
					</option>
				</select>
			</div>
		</div>
	</div>
	
	<div class="row">
		<div class="col-xs-3">
			<div class="form-group">
				<label for="reportStatus">Report Status</label>
				<select id="reportStatus" class="form-control" value.bind="assessment.reportStatus" matcher.bind="reportStatusMatcher">
					<option></option>
					<option repeat.for="reportStatus of reportStatuses" model.bind="reportStatus">
						${reportStatus.name}
					</option>
				</select>
			</div>
		</div>
		<div class="col-xs-3">
			<div class="form-group">
				<label for="fileSize">File Size</label>
				<input id="fileSize" type="number" class="form-control" value.bind="assessment.fileSize" />
			</div>
		</div>
		<div class="col-xs-3">
			<div class="checkbox">
				<label>
					<input type="checkbox" checked.bind="assessment.isLargeFile" />&nbsp;Large?
				</label>
			</div>
		</div>
	</div>
	
	<div class="row">
		<div class="col-xs-12">
			<table class="table table-striped table-condensed">
				<caption>Notes</caption>
				<thead>
					<tr>
						<th>
							<button type="button" class="btn btn-default btn-xs" click.delegate="newNote()">
								<i class="fa fa-plus"></i>
							</button>
						</th>
						<th>Note</th>
						<th>Update Date</th>
						<th>Updated By</th>
						<th></th>
					</tr>
				</thead>
				<tbody>
					<tr repeat.for="note of assessment.notes"><!--  | noteForUser:user-->
						<td>
							<button type="button" class="btn btn-default btn-xs" click.delegate="editNote(note)">
								<i class="fa fa-edit"></i>
							</button>
						</td>
						<td>${note.noteText}</td>
						<td>${note.updateDate | timeAgo}</td>
						<td>${note.updateUser.firstName} ${note.updateUser.lastName}</td>
						<td>
							<button type="button" class="btn btn-danger btn-xs" click.delegate="removeNote(note)">
								<i class="fa fa-times"></i>
							</button>
						</td>
					</tr>
				</tbody>
			</table>
		</div>
	</div>
	
	<div class="row">
		<div class="col-xs-9">
			<div class="form-group">
				<label for="summary">Summary</label>
				<textarea id="summary" class="form-control form-control-wide form-control-tall" value.bind="assessment.summary.noteText"></textarea>
			</div>
		</div>
		<div class="col-xs-3">
			<div class="form-group">
				<label>Colors</label>
				<div class="checkbox" repeat.for="color of colors">
					<label>
						<input type="checkbox" model.bind="color" checked.bind="assessment.colors" matcher.bind="colorMatcher" />&nbsp;<span class="color-swatch" css="background-color: ${color.hexCode};"></span>
					</label>
				</div>
			</div>
		</div>
	</div>
	
	<div class="row">
		<div class="col-xs-3">
			<button type="button" class="btn btn-default" click.delegate="back()">
				<i class="fa fa-arrow-left"></i> Back
			</button>
			<button type="button" class="btn btn-primary" click.delegate="save()">
				Save <i class="fa fa-save"></i>
			</button>
		</div>
		<div class="col-xs-9">
			<p if.bind="assessment.createUser"><small>Created by ${assessment.createUser.firstName} ${assessment.createUser.lastName} at ${assessment.createDate | dateFormat:config.longDateTimeFormat}</small></p>
			<p if.bind="assessment.updateUser"><small>Updated by ${assessment.updateUser.firstName} ${assessment.updateUser.lastName} at ${assessment.updateDate | dateFormat:config.longDateTimeFormat}</small></p>
		</div>
	</div>
	
</div>

</template>