<template>
    <require from="resources/value-converters/lower"></require>
    <require from="resources/value-converters/proper"></require>
    <require from="resources/value-converters/number-ordinal"></require>
    <require from="resources/value-converters/sort-array"></require>
    <require from="resources/value-converters/array-to-string"></require>
    <require from="resources/value-converters/filter"></require>
	<require from="claimants/search-claimant"></require>
    
    <div class="uk-container">

        <form class="uk-form-stacked">

            <div class="uk-margin-small uk-width-auto">
                <label class="uk-form-label">Claimant</label>
                <div class="uk-form-controls">
                    <search-claimant claimant.bind="results.claimant" selected.delegate="claimantSelected($event)"></search-claimant>
                </div>
            </div>
            
            <div class="uk-margin-small" if.bind="results.claimant">
                <p>
                    ${results.claimant.firstName} ${results.claimant.lastName}
                </p>
            </div>

        </form>

    </div>

    <div class="uk-container" if.bind="results.claimant">

        <form class="uk-form-stacked">
            <fieldset class="uk-fieldset">
                <legend class="uk-legend">Psychological Tests</legend>

                <div class="uk-section uk-section-xsmall">
                    <h5 class="uk-heading-line"><span>Visual Analogue Pain Scales</span></h5>

                    <table class="uk-table uk-table-small">
                        <tbody>
                            <tr>
                                <td class="uk-width-medium">
                                    <label class="uk-form-label" for="currentPainNumber">Current Pain Number</label>
                                </td>
                                <td>
                                    <select id="currentPainNumber" class="uk-select uk-form-small uk-form-width-xsmall" value.bind="results.painIssues.visualScale.currentNumber">
                                        <option></option>
                                        <option repeat.for="i of painScale" model.bind="i">${i}</option>
                                    </select>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <label class="uk-form-label" for="badDayPainNumber">Bad Day Pain Number</label>
                                </td>
                                <td>
                                    <select id="badDayPainNumber" class="uk-select uk-form-small uk-form-width-xsmall" value.bind="results.painIssues.visualScale.badDayNumber">
                                        <option></option>
                                        <option repeat.for="i of painScale" model.bind="i">${i}</option>
                                    </select>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <label class="uk-form-label" for="goodDayPainNumber">Good Day Pain Number</label>
                                </td>
                                <td>
                                    <select id="goodDayPainNumber" class="uk-select uk-form-small uk-form-width-xsmall" value.bind="results.painIssues.visualScale.goodDayNumber">
                                        <option></option>
                                        <option repeat.for="i of painScale" model.bind="i">${i}</option>
                                    </select>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div class="uk-section uk-section-xsmall">
                    <h5 class="uk-heading-line"><span>Pain Disability Index</span></h5>

                    <div class="uk-margin-small">
                        <div class="uk-form-label">Areas of Dysfunction</div>

                        <table class="uk-table uk-table-small">
                            <tbody>
                                <template repeat.for="dysfunctionRating of results.painIssues.disabilityIndex.dysfunctionRatings">
                                    <tr>
                                        <td class="uk-width-medium">
                                            <label class="uk-form-label" for="dysfunction-${$index}">${areasOfDysfunction[dysfunctionRating.value].description}</label>
                                        </td>
                                        <td class="uk-width-small">
                                            <select id="dysfunction-${$index}" class="uk-select uk-form-small uk-form-width-xsmall" value.bind="dysfunctionRating.rating" disabled.bind="dysfunctionRating.declinedToAnswer" change.delegate="dysfunctionRatingChanged()">
                                                <option></option>
                                                <option repeat.for="i of dysfunctionScale" model.bind="i">${i}</option>
                                            </select>
                                        </td>
                                        <td>
                                            <template if.bind="areasOfDysfunction[dysfunctionRating.value].canDeclineToAnswer">
                                                <label>
                                                    <input type="checkbox" name="dysfunction-${$index}" class="uk-checkbox" checked.bind="dysfunctionRating.declinedToAnswer" value.bind="true" change.delegate="dysfunctionRatingChanged()" />&nbsp;Declined to answer&nbsp;
                                                </label>
                                            </template>
                                        </td>
                                    </tr>
                                </template>
                            </tbody>
                        </table>
                    </div>
    
                </div>

                <div class="uk-section uk-section-xsmall">
                    <h5 class="uk-heading-line"><span>Pain Catastrophizing Scale</span></h5>

                    <table class="uk-table uk-table-small">
                        <tbody>
                            <tr>
                                <td class="uk-width-medium">
                                    <label class="uk-form-label" for="catastrophizingScaleIsValid">Valid?</label>
                                </td>
                                <td>
                                    <label repeat.for="response of yesNo">
                                        <input type="radio" name="catastrophizingScaleIsValid" class="uk-radio" checked.bind="results.painIssues.catastrophizingScale.isValid" model.bind="response.value" change.delegate="changed('catastrophizing-scale-changed')" />&nbsp;${response.description}&nbsp;
                                    </label>
                                </td>
                            </tr>
                            <template if.bind="results.painIssues.catastrophizingScale.isValid & signal:'catastrophizing-scale-changed'">
                                <tr>
                                    <td>
                                        <label class="uk-form-label">Rumination</label>
                                    </td>
                                    <td>
                                        <input type="number" step="1" min="0" max="100" name="catastrophizingScaleRumination" class="uk-input uk-form-small uk-form-width-small" value.bind="results.painIssues.catastrophizingScale.rumination" input.delegate="changed('catastrophizing-scale-changed') & debounce:500" />
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <label class="uk-form-label">Helplessness</label>
                                    </td>
                                    <td>
                                        <input type="number" step="1" min="0" max="100" name="catastrophizingScaleHelplessness" class="uk-input uk-form-small uk-form-width-small" value.bind="results.painIssues.catastrophizingScale.helplessness" input.delegate="changed('catastrophizing-scale-changed') & debounce:500" />
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <label class="uk-form-label">Magnification</label>
                                    </td>
                                    <td>
                                        <input type="number" step="1" min="0" max="100" name="catastrophizingScaleMagnification" class="uk-input uk-form-small uk-form-width-small" value.bind="results.painIssues.catastrophizingScale.magnification" input.delegate="changed('catastrophizing-scale-changed') & debounce:500" />
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <label class="uk-form-label">Total Score</label>
                                    </td>
                                    <td>
                                        <input type="number" step="1" min="0" max="100" name="catastrophizingScaleTotalScore" class="uk-input uk-form-small uk-form-width-small" value.bind="results.painIssues.catastrophizingScale.totalScore" input.delegate="changed('catastrophizing-scale-changed') & debounce:500" />
                                    </td>
                                </tr>
                            </template>
                        </tbody>
                    </table>
                </div>

                
                <div class="uk-section uk-section-xsmall">
                    <h5 class="uk-heading-line"><span>BBHI</span></h5>

                    <table class="uk-table uk-table-small">
                        <tbody>
                            <tr>
                                <td class="uk-width-medium">
                                    <label class="uk-form-label" for="bbhiIsValid">Valid?</label>
                                </td>
                                <td>
                                    <label repeat.for="response of yesNo">
                                        <input type="radio" name="bbhiIsValid" class="uk-radio" checked.bind="results.painIssues.bbhi.isValid" model.bind="response.value" change.delegate="changed('bbhi-changed')" />&nbsp;${response.description}&nbsp;
                                    </label>
                                </td>
                            </tr>
                            <template if.bind="results.painIssues.bbhi.isValid & signal:'bbhi-changed'">
                                <tr>
                                    <td>
                                        <label class="uk-form-label">Somatic</label>
                                    </td>
                                    <td>
                                        <select class="uk-select uk-form-small uk-form-width-medium" value.bind="results.painIssues.bbhi.somatic" change.delegate="changed('bbhi-changed')">
                                            <option></option>
                                            <option repeat.for="response of bbhiScaleRatings" model.bind="response.value">${response.description}</option>
                                        </select>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <label class="uk-form-label">Pain</label>
                                    </td>
                                    <td>
                                        <select class="uk-select uk-form-small uk-form-width-medium" value.bind="results.painIssues.bbhi.pain" change.delegate="changed('bbhi-changed')">
                                            <option></option>
                                            <option repeat.for="response of bbhiScaleRatings" model.bind="response.value">${response.description}</option>
                                        </select>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <label class="uk-form-label">Functional</label>
                                    </td>
                                    <td>
                                        <select class="uk-select uk-form-small uk-form-width-medium" value.bind="results.painIssues.bbhi.functional" change.delegate="changed('bbhi-changed')">
                                            <option></option>
                                            <option repeat.for="response of bbhiScaleRatings" model.bind="response.value">${response.description}</option>
                                        </select>
                                    </td>
                                </tr>
                            </template>
                        </tbody>
                    </table>
                </div>

            </fieldset>

        </form>
    </div>

    <div class="uk-container" if.bind="results.claimant" style="font-family: arial; font-size: 11pt; font-weight: normal;">
        <h5 class="uk-heading-line"><span>Psychological Assessment Summary</span></h5>

        <p contenteditable="true">
            In this present evaluation, the results for pain severity, as measured by Visual Analogue Pain Scales (which does not have any validity measures), 
            show a current pain rating to be in ${painRatings[results.painIssues.visualScale.currentNumber].format(self)} band (${results.painIssues.visualScale.currentNumber}/${painScaleMax}); 
            with respect to chronic pain patient norms, and that the pain can increase to a 
            ${results.painIssues.visualScale.badDayNumber}/${painScaleMax} on a “bad” day, and only goes to a ${results.painIssues.visualScale.goodDayNumber}/${painScaleMax} on a “good” day. 
        </p>

        <p contenteditable="true">
            ${results.gender.title} ${results.claimant.lastName}'s aggregate result for the Pain Disability Index (PDI) shows that ${results.pronoun.subject} rated in 
            ${disabilityRatingOverall.format(self)} range for level of self-perceived disability as a result of ${results.pronoun.possessiveAdjective} pain symptomatology, 
            with respect to chronic pain patient norms
            <template if.bind="declinedToAnswerSexualBehaviors & signal:'psychological-assessment-dysfunction-rating-changed'">
                &nbsp;(noting that ${results.pronoun.subject} chose to not answer the question regarding sexual behaviours)
            </template>
            .
            &nbsp;In particular, ${results.pronoun.subject} 
            <template repeat.for="group of disabilityRatingGroups & signal:'psychological-assessment-dysfunction-rating-changed'">
                <template if.bind="!$first">;</template>
                <template if.bind="!$first">&nbsp;and</template>
                &nbsp;ascribed ${group.format(self)} degree of dysfunction 
                <template repeat.for="area of group.areasOfDysfunction">
                    <template if.bind="!$first">,</template>
                    <template if.bind="$last && !$first">&nbsp;and</template>
                    &nbsp;for ${results.pronoun.possessiveAdjective} ${areasOfDysfunction[area].format(self)}
                </template>
            </template>
            .
        </p>
        
        <p contenteditable="true">
            <template if.bind="results.painIssues.catastrophizingScale.isValid & signal:'catastrophizing-scale-changed'">
                <template if.bind="anyElevatedCatastrophizingScaleItems & signal:'catastrophizing-scale-changed'">
                    On the Pain Catastrophizing Scale (PCS), ${results.gender.title} ${results.claimant.lastName} was elevated with respect to 
                    <template repeat.for="item of elevatedCatastrophizingScaleItems">
                        <template if.bind="!$first">,</template>
                        <template if.bind="$last && !$first">&nbsp;and</template>
                        &nbsp;${item.description} (${item.percentile | numberOrdinal} percentile)
                    </template>
                    <template if.bind="isCatastrophizingScaleTotalScoreElevated & signal:'catastrophizing-scale-changed'">
                        , as well as the Total score (${results.painIssues.catastrophizingScale.totalScore} percentile)
                    </template>
                    .
                    <template if.bind="anyNotElevatedCatastrophizingScaleItems & signal:'catastrophizing-scale-changed'">
                        &nbsp;In addition ${results.gender.title} ${results.claimant.lastName} was not elevated with respect to 
                        <template repeat.for="item of notElevatedCatastrophizingScaleItems">
                            <template if.bind="!$first">,</template>
                            <template if.bind="$last && !$first">&nbsp;and</template>
                            &nbsp;${item.description} (${item.percentile | numberOrdinal} percentile)
                        </template>
                        <template if.bind="isCatastrophizingScaleTotalScoreNotElevated & signal:'catastrophizing-scale-changed'">
                            , as well as the Total score (${results.painIssues.catastrophizingScale.totalScore} percentile)
                        </template>
                        .
                    </template>
                </template>
                <template else>
                    <template if.bind="anyNotElevatedCatastrophizingScaleItems & signal:'catastrophizing-scale-changed'">
                        On the Pain Catastrophizing Scale (PCS), ${results.gender.title} ${results.claimant.lastName} was not elevated with respect to 
                        <template repeat.for="item of notElevatedCatastrophizingScaleItems">
                            <template if.bind="!$first">,</template>
                            <template if.bind="$last && !$first">&nbsp;and</template>
                            &nbsp;${item.description} (${item.percentile | numberOrdinal} percentile)
                        </template>
                        <template if.bind="isCatastrophizingScaleTotalScoreNotElevated & signal:'catastrophizing-scale-changed'">
                            , as well as the Total score (${results.painIssues.catastrophizingScale.totalScore} percentile)
                        </template>
                        .
                    </template>
                </template>
            </template>
            <template if.bind="!results.painIssues.catastrophizingScale.isValid & signal:'catastrophizing-scale-changed'">
                Based on ${results.gender.title} ${results.claimant.lastName}'s responses, the obtained Pain Catastrophizing Scale (PCS) profile was invalid.
            </template>
        </p>

        <p contenteditable="true">
            <template if.bind="results.painIssues.bbhi.isValid & signal:'bbhi-changed'">
                The scales of the BBHI-2 sensitive to somatic complaints were in the ${bbhiScaleRatingsMap[results.painIssues.bbhi.somatic].format(self)} range.
                &nbsp;The scales in relation to the pain complains were in the ${bbhiScaleRatingsMap[results.painIssues.bbhi.pain].format(self)} range, 
                and the scales in relation to the functional complaints were in the ${bbhiScaleRatingsMap[results.painIssues.bbhi.functional].format(self)} range.
            </template>
            <template if.bind="!results.painIssues.bbhi.isValid & signal:'bbhi-changed'">
                Based on ${results.gender.title} ${results.claimant.lastName}’s responses the obtained BBHI-2 profile was invalid.
            </template>
        </p>

        <p contenteditable="true">
            &nbsp;
        </p>
    </div>

    <div class="uk-container" if.bind="results.claimant">
        <h5 class="uk-heading-line"><span>Cognitive Assessment</span></h5>

        <form class="uk-form-stacked">

            <div class="uk-margin uk-overflow-auto">

                <table class="uk-table uk-table-divider uk-table-small">
                    <thead>
                        <tr>
                            <th class="uk-table-middle">
                                <label class="uk-form-label" for="effort">Effort Level</label>
                                <select id="effort" class="uk-select uk-form-small uk-form-width-small" value.bind="cognitiveAssessment.effortLevel">
                                    <option></option>
                                    <option repeat.for="level of cognitiveAssessmentEffortLevels" model.bind="level">${level.description}</option>
                                </select>
                            </th>
                            <template repeat.for="rating of cognitiveAssessmentTestResultRatings">
                                <th style="writing-mode: vertical-rl;">
                                    ${rating.description}
                                </th>
                            </template>
                            <th style="writing-mode: vertical-rl;"></th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr repeat.for="test of cognitiveAssessment.tests">
                            <td class="uk-text-nowrap uk-table-shrink uk-padding-remove">${test.category}</td>
                            <template repeat.for="rating of cognitiveAssessmentTestResultRatings">
                                <td class="uk-padding-remove">
                                    <input type="radio" name="${test.category} rating" class="uk-radio" checked.bind="$parent.test.rating" model.bind="rating" change.delegate="cognitiveAssessmentTestResultRatingChange()" />
                                </td>
                            </template>
                            <td class="uk-padding-remove">
                                <span click.delegate="clearTestRating(test)" show.bind="test.rating !== null" style="color: red; cursor: pointer;">
                                    <i class="fa fa-close"></i>
                                </span>
                            </td>
                        </tr>
                    </tbody>
                </table>

            </div>

        </form>

    </div>

    <div class="uk-container" if.bind="results.claimant">
        <h5 class="uk-heading-line"><span>Cognitive Assessment Summary</span></h5>

        <table class="uk-table uk-table-small uk-table-middle uk-table-divider" style="font-family: arial; font-size: 11pt; font-weight: normal; border-width: 1px;">
            <thead>
                <tr>
                    <th></th>
                    <template repeat.for="rating of cognitiveAssessmentTestResultRatings">
                        <th style="border-style: solid; border-width: 1px; writing-mode: vertical-rl;">
                            ${rating.description}
                        </th>
                    </template>
                </tr>
            </thead>
            <tbody>
                <tr repeat.for="test of cognitiveAssessment.tests | filter:isRated & signal:'cognitive-assessment-test-result-rating-updated'">
                    <td style="border-style: solid; border-width: 1px;" class="uk-text-nowrap">${test.category}</td>
                    <template repeat.for="rating of cognitiveAssessmentTestResultRatings">
                        <td style="border-style: solid; border-width: 1px;" class="uk-text-nowrap uk-text-center">
                            <template if.bind="$parent.test.rating.description === rating.description">&times;</template>
                        </td>
                    </template>
                </tr>
            </tbody>
        </table>

        <p style="font-family: arial; font-size: 11pt; font-weight: normal;">
            In summary, against an overlay of ${cognitiveAssessment.effortLevel.description} effort, here are ${results.gender.title} ${results.claimant.lastName}'s results:
            <br><br>
            <template repeat.for="grouping of cognitiveAssessmentTestResultGroupings | sortArray:{property: 'sort', direction: 'asc'}">
                <div class="uk-margin-left">    
                    <span style="font-family: arial; font-size: 11pt; font-weight: normal;">
                        ${results.pronoun.subject | proper} performed ${grouping.opening} on tests and questionnaires that measured ${results.pronoun.possessiveAdjective}: 
                    </span>
                    <ul style="font-family: arial; font-size: 11pt; font-weight: normal;" class="uk-margin-remove-top">
                        <template repeat.for="test of grouping.tests">
                            <li>${test.category}</li>
                        <template>
                    </ul>
                </div>
            </template>

        </p>

    </div>

</template>